{"version":3,"sources":["../dev/main.es"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["/**\n * @module Passport\n * @desc 通行证模块，包括登录、注册逻辑控制和部分总体样式控制\n */\ndefine(['backbone', 'jqValidate'], function(Backbone) {\n  return {\n    /**\n     * @lends Passport\n     */\n    run: function() {\n      /**\n       * @desc canvas动画背景以及添加resize事件\n       */\n      function initCanvas() {\n        let img = new Image();\n        img.onload = function() {\n          // 浏览器viewport的尺寸\n          let winWidth, winHeight;\n          // 图片的尺寸信息，如果不支持此API需人工写入尺寸\n          let imgW = img.width || 145,\n            imgH = img.height || 74,\n            imgW_min = imgW * 0.65 || 93,\n            imgH_min = imgH * 0.65 || 48;\n          // 页面主体的最小宽度，可修改\n          let bodyMinwidth = 970;\n          // 每个图片的位置坐标\n          let locate_1, locate_2, locate_3;\n\n          let $body = $('.hc_pwd_container');\n          let bodyHeight = $body.height();\n          $body.css({\n            marginTop: -bodyHeight / 2\n          }).animate({\n            opacity: 1\n          }, 500);\n\n          let canvas = $('#canvas_bak .canvas')[0];\n          let ctx = canvas.getContext('2d');\n          // 逐帧绘制canvas\n          function draw() {\n            ctx.clearRect(0, 0, winWidth, winHeight);\n            let grad = ctx.createLinearGradient(0, 0, 0, winHeight);\n            grad.addColorStop(0, '#2196F3');\n            grad.addColorStop(1, '#99ccff');\n            ctx.fillStyle = grad;\n            ctx.fillRect(0, 0, winWidth, winHeight);\n            ctx.drawImage(img, locate_1.x, locate_1.y, imgW, imgH);\n            ctx.drawImage(img, locate_2.x, locate_2.y, imgW_min,\n              imgH_min);\n            ctx.drawImage(img, locate_3.x, locate_3.y, imgW, imgH);\n\n            locate_1.x = locate_1.x >= winWidth ? -imgW : ++locate_1.x;\n            locate_2.x = locate_2.x >= winWidth ? -imgW_min : ++\n              locate_2.x;\n            locate_3.x = locate_3.x >= winWidth ? -imgW : ++locate_3.x;\n\n            window.requestAnimationFrame(draw);\n          }\n          // 获取viewport尺寸以方便动画定位\n          function getSize() {\n            winWidth = $(window).width();\n            winHeight = $(window).height();\n            canvas.width = winWidth;\n            canvas.height = winHeight;\n\n            locate_1 = {\n              x: (winWidth - bodyMinwidth) / 2,\n              y: winHeight / 2 - imgW\n            };\n            locate_2 = {\n              x: winWidth / 2 - 120,\n              y: winHeight / 2 + 100\n            };\n            locate_3 = {\n              x: winWidth / 2 + 120,\n              y: locate_2.y - 20 - imgH\n            };\n          }\n\n          getSize();\n          $(window).on('resize', getSize);\n          window.requestAnimationFrame(draw);\n        };\n        img.src = '/res/img/global/cloud.png';\n      }\n      /**\n       * @desc backbone hash路由\n       */\n      function initRouter() {\n        let $formBox = $('.box_form_container'),\n          $navitems = $('.box_nav_item'),\n          $nav_item_signup = $('.box_nav_item_signup'),\n          $nav_item_login = $('.box_nav_item_login');\n        let pwdRouter = Backbone.Router.extend({\n          routes: {\n            'login': 'login',\n            'signup': 'signup'\n          },\n          login: function() {\n            $formBox.removeClass('box_form_container_signup').addClass(\n              'box_form_container_login');\n            $navitems.removeClass('box_nav_item-current');\n            $nav_item_login.addClass('box_nav_item-current');\n          },\n          signup: function() {\n            $formBox.removeClass('box_form_container_login').addClass(\n              'box_form_container_signup');\n            $navitems.removeClass('box_nav_item-current');\n            $nav_item_signup.addClass('box_nav_item-current');\n          }\n        });\n        let router = new pwdRouter();\n        Backbone.history.start();\n      }\n\n      function initValidate() {\n        // 修改错误提示文案\n        $.extend($.validator.messages, {\n          required: \"不能为空\",\n          email: \"邮箱格式不正确\",\n          minlength: $.validator.format('不能少于{0}个字符串'),\n          maxlength: $.validator.format('不能超过{0}个字符串'),\n        });\n        // 添加用户名+邮箱的双重验证规则\n        $.validator.addMethod('signname', function(value, element) {\n          let reg_isemail = /[@]/,\n            reg_email =\n            /^[a-z]([a-z0-9]*[-_]?[a-z0-9]+)*@([a-z0-9]*[-_]?[a-z0-9]+)+[\\.][a-z]{2,3}([\\.][a-z]{2})?$/i;\n          return !reg_isemail.test(value) || (reg_isemail.test(value) &&\n            reg_email.test(value));\n        }, '请输入正确的用户名或邮箱');\n        // 注册表单添加验证规则\n        $('.signup_form').validate({\n          rules: {\n            authname: {\n              required: true,\n              maxlength: 15\n            },\n            email: {\n              required: true,\n              email: true\n            },\n            password: {\n              required: true,\n              minlength: 6\n            }\n          },\n          errorPlacement: function(error, element) {\n            let container = element.parent().find('.form_error');\n            error.appendTo(container);\n            container.show();\n          },\n          submitHandler: function(form) {\n            var $form = $(form);\n            let _action = $form.attr('action');\n            $form.attr('action', '');\n            $.ajax({\n              type: 'post',\n              url: _action,\n              data: $form.serialize(),\n              dataType: 'json'\n            }).done(function(res) {\n              console.log('done');\n              if (res.code !== '100') {\n                alert(res.message);\n              }\n            }).fail(function(res) {\n              console.log('fail');\n            }).always(function() {\n              $form.attr('action', _action);\n            });\n          }\n        });\n        // 登录表单添加验证规则\n        $('.login_form').validate({\n          rules: {\n            signname: {\n              required: true,\n              signname: true\n            },\n            password: {\n              required: true\n            }\n          },\n          errorPlacement: function(error, element) {\n            let container = element.parent().find('.form_error');\n            error.appendTo(container);\n            container.show();\n          },\n          submitHandler: function(form) {\n            var $form = $(form);\n            let _action = $form.attr('action');\n            $form.attr('action', '');\n            $.ajax({\n              type: 'post',\n              url: _action,\n              data: $form.serialize(),\n              dataType: 'json'\n            }).done(function(res) {\n              console.log('done');\n              if (res.code !== '100') {\n                alert(res.message);\n              } else {\n                alert('注册成功');\n              }\n            }).fail(function(res) {\n              console.log('fail');\n            }).always(function() {\n              $form.attr('action', _action);\n            });\n          }\n        });\n      }\n\n      initRouter();\n      initValidate();\n      initCanvas();\n    }\n  }\n});\n"]}